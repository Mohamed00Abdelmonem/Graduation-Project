{% extends "base.html" %}
{% load static %}

{% block body %}
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #d7dee5 0%, #f4f7fa 100%);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 40px 20px;
    color: #d9d9d9;
  }

  /* Container */
  .generator-section {
    background: rgba(0, 70, 88, 0.8); /* اللون الأساسي مع شفافية */
    max-width: 720px;
    width: 100%;
    border-radius: 16px;
    box-shadow:
      0 4px 12px rgba(0, 70, 88, 0.6),
      0 0 20px rgba(81, 182, 76, 0.4);
    padding: 32px 36px;
    display: flex;
    flex-direction: column;
    gap: 28px;
  }

  /* العنوان */
  h1 {
    font-weight: 700;
    font-size: 2.8rem;
    color: #8bc34a; /* لون أخضر فاتح لطيف */
    text-align: center;
    letter-spacing: 1.4px;
    margin-bottom: 8px;
  }

  /* Result Section */
  .generated-text {
    background: rgba(255 255 255 / 0.1);
    border-radius: 14px;
    padding: 24px 28px;
    min-height: 180px;
    font-family: 'Source Code Pro', monospace, monospace;
    font-size: 1rem;
    line-height: 1.6;
    color: #d9d9d9;
    box-shadow: inset 0 0 10px rgba(0, 70, 88, 0.6);
    overflow-y: auto;
    white-space: pre-wrap;
  }

  .generated-text h2 {
    font-weight: 600;
    font-size: 1.9rem;
    margin-bottom: 16px;
    color: #a3d77d;
    text-align: center;
  }

  /* Input Form */
  .input-form {
    display: flex;
    gap: 20px;
  }

  #input_text {
    flex-grow: 1;
    padding: 16px 20px;
    font-size: 1.05rem;
    border-radius: 16px;
    border: none;
    background: rgba(255 255 255 / 0.12);
    color: #d9d9d9;
    resize: vertical;
    min-height: 100px;
    box-shadow: inset 0 0 12px rgba(0, 70, 88, 0.8);
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }

  #input_text::placeholder {
    color: #9ccaa3;
  }

  #input_text:focus {
    outline: none;
    background: rgba(255 255 255 / 0.18);
    box-shadow: 0 0 12px 2px #a3d77d;
    color: white;
  }

  /* Button */
  button.btn {
    background: linear-gradient(135deg, #4caf50, #81c784);
    border: none;
    border-radius: 56px;
    color: #ffffff;
    font-weight: 700;
    font-size: 1.15rem;
    padding: 0 28px;
    cursor: pointer;
    transition: background 0.3s ease, box-shadow 0.3s ease;
    min-width: 110px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  button.btn:hover {
    background: linear-gradient(135deg, #81c784, #4caf50);
    box-shadow: 0 0 18px #a3d77d;
  }
body {
    font-size: 16px;
    background-color: rgb(215, 222, 229);
    min-height: 100vh;
    margin: 0;
    padding: 0;
    direction: ltr;  /* اتجاه النص من اليسار لليمين */
    font-family: 'Lugrasimo', cursive, sans-serif;
}

.generator-section {
    width: 100vw;
    height: 100vh;
    max-width: none;
    background-color: #004658c7;
    padding: 40px 60px;
    border-radius: 0;
    box-shadow: none;
    color: rgb(225, 231, 236);
    display: flex;
    flex-direction: column;
    gap: 30px;
    box-sizing: border-box;
}

/* العنوان */
h1 {
    text-align: center;
    color: rgb(131, 139, 134);
    font-weight: 700;
    font-size: 2.5rem;
    letter-spacing: 2px;
}

/* محتوى النتائج */
.generated-text h2 {
    margin-bottom: 15px;
    color: rgb(81, 182, 76);
    text-align: center;
    font-weight: 600;
    font-size: 1.8rem;
}

.generated-text #output {
    background-color: rgba(255 255 255 / 0.15);
    padding: 15px 20px;
    border-radius: 10px;
    min-height: 150px;
    white-space: pre-wrap;
    font-family: monospace;
    font-size: 1rem;
    color: #d9d9d9;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
}

/* الفورم */
.input-form {
    display: flex;
    justify-content: center; /* يوسّط الفورم أفقياً */
}

#aiForm {
    display: flex;
    gap: 15px;
    align-items: stretch;
    width: 50vw;  /* نصف عرض الصفحة */
    min-width: 300px; /* حد أدنى للعرض */
}

#input_text {
    flex-grow: 1;
    padding: 15px 20px;
    font-size: 1rem;
    border-radius: 12px;
    border: none;
    background-color: rgba(255 255 255 / 0.15);
    color: #d9d9d9;
    resize: vertical;
    box-shadow: inset 0 0 8px rgba(0,0,0,0.2);
    transition: background-color 0.3s ease;
}

#input_text::placeholder {
    color: #b0c5c9;
}

#input_text:focus {
    outline: none;
    background-color: rgba(255 255 255 / 0.25);
    box-shadow: 0 0 8px 2px rgb(81, 182, 76);
    color: white;
}

button.btn {
    background-color: rgb(81, 182, 76);
    color: white;
    border: none;
    padding: 0 25px;
    font-size: 1.1rem;
    font-weight: 600;
    border-radius: 12px;
    cursor: pointer;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 110px;
}

button.btn:hover {
    background-color: rgb(66, 152, 61);
    box-shadow: 0 0 10px rgb(81, 182, 76);
}

/* Responsive للهواتف */
@media (max-width: 600px) {
    #aiForm {
        flex-direction: column;
        width: 90vw;  /* عشان يشغل عرض أكبر على الموبايل */
    }
    button.btn {
        width: 100%;
        min-width: auto;
        padding: 15px 0;
    }
    #input_text {
        min-height: 100px;
    }
}

  /* Responsive */
  @media (max-width: 620px) {
    .input-form {
      flex-direction: column;
    }
    button.btn {
      width: 100%;
      min-width: auto;
      padding: 14px 0;
      font-size: 1.1rem;
      border-radius: 12px;
    }
    #input_text {
      min-height: 120px;
    }
  }
</style>

<div class="generator-section" role="main" aria-label="Language model interface">
  <h1>MET (LLM)</h1>

  <div class="generated-text" aria-live="polite" aria-atomic="true">
    <h2>Result</h2>
    <div id="output" tabindex="0"></div>
  </div>

  <div class="input-form">
    <form id="aiForm" onsubmit="sendRequest(event)" aria-label="Text input form">
      {% csrf_token %}
      <textarea
        id="input_text"
        name="input_text"
        rows="4"
        placeholder="Enter your text here..."
        aria-required="true"
        aria-describedby="output"
      ></textarea>
      <button type="submit" class="btn" aria-label="Send text input">Send</button>
    </form>
  </div>
</div>

<script>
  async function sendRequest(event) {
    event.preventDefault();

    const inputText = document.getElementById('input_text').value.trim();
    const outputDiv = document.getElementById('output');
    outputDiv.innerHTML = ''; // clear previous result

    if (!inputText) {
      outputDiv.innerText = 'Please enter some text.';
      return;
    }

    const formData = new FormData();
    formData.append('input_text', inputText);

    try {
      const response = await fetch("{% url 'generate' %}", {
        method: 'POST',
        headers: {
          'X-CSRFToken': '{{ csrf_token }}'
        },
        body: formData
      });

      if (!response.ok) throw new Error('Network response was not ok');

      const data = await response.json();
      typeText(data.generated_text, outputDiv);
    } catch (error) {
      outputDiv.innerText = 'Error occurred while generating text.';
      console.error(error);
    }
  }

  function typeText(text, element, delay = 25) {
    // remove any HTML-like tags such as <think>...</think>
    const cleanText = text.replace(/<[^>]*>/g, '');

    let index = 0;
    function typeChar() {
      if (index < cleanText.length) {
        element.innerHTML += cleanText.charAt(index);
        index++;
        setTimeout(typeChar, delay);
      }
    }
    typeChar();
  }
</script>
{% endblock %}
