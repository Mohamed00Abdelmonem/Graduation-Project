{% extends "base.html" %}
{% load bootstrap5 %}
{% block body %}

<section class="bj_author_single_area pb-0" style="padding-top: 4rem" data-bg-color="#f5f5f5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-10" style="margin-top: 6rem;">
                <div class="card shadow">

                    <!-- Display Django Messages -->
                    {% if messages %}
                        <div class="messages">
                            {% for message in messages %}
                                <div class="alert alert-{{ message.tags }} alert-dismissible fade show 
                                    {% if message.tags == 'success' %}bg-success text-white
                                    {% elif message.tags == 'error' %}bg-danger text-white
                                    {% elif message.tags == 'warning' %}bg-warning text-dark
                                    {% else %}bg-primary text-white
                                    {% endif %}" role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}

                    <div>
                        <h3 class="card-title text-center">ØªØ­Ø¯ÙŠØ« Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ØªØ®Ø±Ø¬ ğŸ“</h3>
                    </div>
                    <div class="card-body">
                        <form method="post" style="text-align:center" enctype="multipart/form-data">
                            {% csrf_token %}
                            <div class="row gy-4">
                                <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
                                <div class="form-group col-md-4">
                                    <label for="id_title">Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„Ù„ØºÙ‡ Ø§Ù„Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠÙ‡</label>
                                    <input type="text" class="form-control" id="id_title" name="title" value="{{ form.title.value|default_if_none:'' }}" required>
                                    {% if form.title.errors %}
                                        <div class="alert alert-danger">{{ form.title.errors }}</div>
                                    {% endif %}

                                    <label for="id_title_ar">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø§Ù„ØºÙ‡ Ø§Ù„Ø¹Ø±Ø¨ÙŠÙ‡</label>
                                    <input type="text" class="form-control" id="id_title_ar" name="title_ar" value="{{ form.title_ar.value|default_if_none:'' }}" required>
                                    {% if form.title_ar.errors %}
                                        <div class="alert alert-danger">{{ form.title_ar.errors }}</div>
                                    {% endif %}

                                    <!-- Ø³Ù†Ø© Ø§Ù„ØªØ®Ø±Ø¬ -->
                                    <label for="id_graduation_year">Ø³Ù†Ø© Ø§Ù„ØªØ®Ø±Ø¬</label>
                                    <input type="number" class="form-control" id="id_graduation_year" name="graduation_year" value="{{ form.graduation_year.value|default_if_none:'' }}" required>
                                    {% if form.graduation_year.errors %}
                                        <div class="alert alert-danger">{{ form.graduation_year.errors }}</div>
                                    {% endif %}
                                </div>

                                <!-- ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
                                <div class="form-group col-md-4">
                                    <label for="id_description">ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                                    <textarea class="form-control" id="id_description" name="description" rows="5" required>{{ form.description.value|default_if_none:'' }}</textarea>
                                    {% if form.description.errors %}
                                        <div class="alert alert-danger">{{ form.description.errors }}</div>
                                    {% endif %}
                                </div>

                                <!-- ÙˆØµÙ Ø§Ø®ØªØµØ§Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
                                <div class="form-group col-md-4">
                                    <label for="id_sub_description">ÙˆØµÙ Ø§Ø®ØªØµØ§Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                                    <textarea class="form-control" id="id_sub_description" name="sub_description" rows="5" required>{{ form.sub_description.value|default_if_none:'' }}</textarea>
                                    {% if form.sub_description.errors %}
                                        <div class="alert alert-danger">{{ form.sub_description.errors }}</div>
                                    {% endif %}
                                </div>

                                <!-- Custom rendering for category (dropdown with search) -->
                                <div class="mb-3 col-md-3">
                                    <label for="id_search_category" class="form-label">Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¬Ø§Ù„:</label>
                                    <input 
                                        type="text" 
                                        id="id_search_category" 
                                        class="form-control" 
                                        placeholder="Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¬Ø§Ù„..."
                                    >
                                    <label for="id_category" class="form-label">Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø¬Ø§Ù„:</label><br>
                                    {% for category in form.fields.category.queryset %}
                                        <div class="form-check category-checkbox">
                                            <input 
                                                class="form-check-input" 
                                                type="radio" 
                                                name="category" 
                                                value="{{ category.id }}" 
                                                id="category_{{ category.id }}"
                                                {% if category.id == form.instance.category.id %}checked{% endif %}
                                            >
                                            <label class="form-check-label" for="category_{{ category.id }}">
                                                {{ category }}
                                            </label>
                                        </div>
                                    {% endfor %}
                                </div>

                                <!-- Custom rendering for doctor (dropdown with search) -->
                                <div class="mb-3 col-md-3">
                                    <label for="id_search_doctor" class="form-label">Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¯ÙƒØªÙˆØ±Ù‡:</label>
                                    <input 
                                        type="text" 
                                        id="id_search_doctor" 
                                        class="form-control" 
                                        placeholder="Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¯ÙƒØªÙˆØ±Ù‡..."
                                    >
                                    <label for="id_doctor" class="form-label">Ø­Ø¯Ø¯ Ø§Ù„Ø¯ÙƒØªÙˆØ±Ù‡:</label><br>
                                    {% for doctor in form.fields.doctor.queryset %}
                                        <div class="form-check doctor-checkbox">
                                            <input 
                                                class="form-check-input" 
                                                type="radio" 
                                                name="doctor" 
                                                value="{{ doctor.id }}" 
                                                id="doctor_{{ doctor.id }}"
                                                {% if doctor.id == form.instance.doctor.id %}checked{% endif %}
                                            >
                                            <label class="form-check-label" for="doctor_{{ doctor.id }}">
                                                {{ doctor }}
                                            </label>
                                        </div>
                                    {% endfor %}
                                </div>

                                <!-- Custom rendering for students (checkboxes with search) -->
                                <div class="mb-3 col-md-3">
                                    <label for="id_search_students" class="form-label">Ø¨Ø­Ø« Ø§Ù„Ø·Ù„Ø§Ø¨:</label>
                                    <input 
                                        type="text" 
                                        id="id_search_students" 
                                        class="form-control mb-2" 
                                        placeholder="Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø·Ù„Ø§Ø¨..."
                                    >
                                    <label for="id_students" class="form-label">Ø­Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨:</label><br>
                                    {% for student in form.fields.students.queryset %}
                                        <div class="form-check student-checkbox">
                                            <input 
                                                class="form-check-input" 
                                                type="checkbox" 
                                                name="students" 
                                                value="{{ student.id }}" 
                                                id="student_{{ student.id }}"
                                                {% if student in form.instance.students.all %}checked{% endif %}
                                            >
                                            <label class="form-check-label" for="student_{{ student.id }}">
                                                {{ student }}
                                            </label>
                                        </div>
                                    {% endfor %}
                                </div>

                                <!-- Custom rendering for supervisors (checkboxes with search) -->
                                <div class="mb-3 col-md-3">
                                    <label for="id_search_supervisors" class="form-label">Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†:</label>
                                    <input 
                                        type="text" 
                                        id="id_search_supervisors" 
                                        class="form-control mb-2" 
                                        placeholder="Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†..."
                                    >
                                    <label for="id_supervisors" class="form-label">Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†:</label><br>
                                    {% for supervisor in form.fields.supervisors.queryset %}
                                        <div class="form-check supervisor-checkbox">
                                            <input 
                                                class="form-check-input" 
                                                type="checkbox" 
                                                name="supervisors" 
                                                value="{{ supervisor.id }}" 
                                                id="supervisor_{{ supervisor.id }}"
                                                {% if supervisor in form.instance.supervisors.all %}checked{% endif %}
                                            >
                                            <label class="form-check-label" for="supervisor_{{ supervisor.id }}">
                                                {{ supervisor }}
                                            </label>
                                        </div>
                                    {% endfor %}
                                </div>

                                <!-- Ù…Ù„Ù PDF -->
                                <div class="form-group">
                                    <label for="id_book_pdf">Ù…Ù„Ù PDF</label>
                                    <input type="file" class="form-control-file" id="id_book_pdf" name="book_pdf">
                                    {% if form.book_pdf.errors %}
                                        <div class="alert alert-danger">{{ form.book_pdf.errors }}</div>
                                    {% endif %}
                                </div>

                                <!-- Ø§Ù„ØµÙˆØ± -->
                                <div class="form-group">
                                    <label for="id_images">ØµÙˆØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ù…ÙŠÙ„ Ø­ØªÙ‰ 4 ØµÙˆØ±)</label>
                                    <input 
                                        type="file" 
                                        class="form-control-file" 
                                        id="id_images" 
                                        name="images" 
                                        multiple 
                                        accept="image/*"
                                        onchange="validateImageCount(this)"
                                    >
                                    {% if form.images.errors %}
                                        <div class="alert alert-danger">{{ form.images.errors }}</div>
                                    {% endif %}
                                </div>

                                <!-- Ø§Ù„ÙÙŠØ¯ÙŠÙˆ -->
                                <div class="form-group">
                                    <label for="id_video">Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</label>
                                    <input type="file" name="video" accept="video/*">
                                    {% if form.video.errors %}
                                        <div class="alert alert-danger">{{ form.video.errors }}</div>
                                    {% endif %}
                                </div>

                                <!-- Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« -->
                                <button type="submit" class="btn btn-primary">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    textarea {
        height: 100px;
    }
</style>

<!-- JavaScript for Filtering and Image Validation -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Filtering for Category
        const searchInputCategory = document.getElementById('id_search_category');
        const categoryCheckboxes = document.querySelectorAll('.category-checkbox');
        searchInputCategory.addEventListener('input', function () {
            const query = searchInputCategory.value.toLowerCase();
            categoryCheckboxes.forEach(function (checkbox) {
                const label = checkbox.querySelector('.form-check-label').textContent.toLowerCase();
                if (label.includes(query)) {
                    checkbox.style.display = 'block';
                } else {
                    checkbox.style.display = 'none';
                }
            });
        });

        // Filtering for Doctor
        const searchInputDoctor = document.getElementById('id_search_doctor');
        const doctorCheckboxes = document.querySelectorAll('.doctor-checkbox');
        searchInputDoctor.addEventListener('input', function () {
            const query = searchInputDoctor.value.toLowerCase();
            doctorCheckboxes.forEach(function (checkbox) {
                const label = checkbox.querySelector('.form-check-label').textContent.toLowerCase();
                if (label.includes(query)) {
                    checkbox.style.display = 'block';
                } else {
                    checkbox.style.display = 'none';
                }
            });
        });

        // Filtering for Students
        const searchInputStudents = document.getElementById('id_search_students');
        const studentCheckboxes = document.querySelectorAll('.student-checkbox');
        searchInputStudents.addEventListener('input', function () {
            const query = searchInputStudents.value.toLowerCase();
            studentCheckboxes.forEach(function (checkbox) {
                const label = checkbox.querySelector('.form-check-label').textContent.toLowerCase();
                if (label.includes(query)) {
                    checkbox.style.display = 'block';
                } else {
                    checkbox.style.display = 'none';
                }
            });
        });

        // Filtering for Supervisors
        const searchInputSupervisors = document.getElementById('id_search_supervisors');
        const supervisorCheckboxes = document.querySelectorAll('.supervisor-checkbox');
        searchInputSupervisors.addEventListener('input', function () {
            const query = searchInputSupervisors.value.toLowerCase();
            supervisorCheckboxes.forEach(function (checkbox) {
                const label = checkbox.querySelector('.form-check-label').textContent.toLowerCase();
                if (label.includes(query)) {
                    checkbox.style.display = 'block';
                } else {
                    checkbox.style.display = 'none';
                }
            });
        });

        // Validate Image Count
        function validateImageCount(input) {
            if (input.files.length > 4) {
                alert('ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ù…ÙŠÙ„ Ø­ØªÙ‰ 4 ØµÙˆØ± ÙÙ‚Ø·.');
                input.value = ''; // Clear the input
            }
        }
    });
</script>

{% endblock body %}