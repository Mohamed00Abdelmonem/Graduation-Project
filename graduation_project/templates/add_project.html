
{% extends "base.html" %}
{% load bootstrap5 %}
{% block body %}


<section class="bj_author_single_area pb-0" style="padding-top: 4rem" data-bg-color="#f5f5f5">
<div class="container">
    


    <div class="row justify-content-center">
        <div class="col-md-10 mb-3a" style="margin-top: 6rem;">
            <div class="card shadow">

                <!-- Display Django Messages -->
                {% if messages %}
                    <div class="messages">
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }} alert-dismissible fade show 
                                {% if message.tags == 'success' %}bg-success text-white
                                {% elif message.tags == 'error' %}bg-danger text-white
                                {% elif message.tags == 'warning' %}bg-warning text-dark
                                {% else %}bg-primary text-white
                                {% endif %}" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}

                <div>
                    <h3 class="card-title text-center">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ØªØ®Ø±Ø¬ ğŸ“</h3>
                </div>
                <div class="card-body">
                    <form method="post" style="text-align:center" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="row gy-4">
                        <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
                        <div class="form-group col-md-4">
                            <label for="id_title">Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„Ù„ØºÙ‡ Ø§Ù„Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠÙ‡</label>
                            <input type="text" class="form-control" id="id_title" name="title" value="{{ form.title.value|default_if_none:'' }}" required>
                            {% if form.title.errors %}
                                <div class="alert alert-danger">{{ form.title.errors }}</div>
                            {% endif %}

                            <label for="id_title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø§Ù„ØºÙ‡ Ø§Ù„Ø¹Ø±Ø¨ÙŠÙ‡ </label>
                            <input type="text" class="form-control" id="id_title" name="title_ar" value="{{ form.title_ar.value|default_if_none:'' }}" required>
                            {% if form.title_ar.errors %}
                                <div class="alert alert-danger">{{ form.title_ar.errors }}</div>
                            {% endif %}
                        <!-- Ø³Ù†Ø© Ø§Ù„ØªØ®Ø±Ø¬ -->
                            <label for="id_graduation_year">Ø³Ù†Ø© Ø§Ù„ØªØ®Ø±Ø¬</label>
                            <input type="number" class="form-control" id="id_graduation_year" name="graduation_year" value="{{ form.graduation_year.value|default_if_none:'' }}" required>
                            {% if form.graduation_year.errors %}
                                <div class="alert alert-danger">{{ form.graduation_year.errors }}</div>
                            {% endif %}
                        </div>

                    
                        <!-- ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
                        <div class="form-group col-md-4">
                            <label for="id_description">ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                            <textarea class="form-control" id="id_description" name="description" style="height: 165px" rows="5" required>{{ form.description.value|default_if_none:'' }}</textarea>
                            {% if form.description.errors %}
                                <div class="alert alert-danger">{{ form.description.errors }}</div>
                            {% endif %}
                        </div>
                
                        <!-- ÙˆØµÙ  Ø§Ø®ØªØµØ§Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
                        <div class="form-group col-md-4">
                            <label for="id_sub_description">ÙˆØµÙ Ø§Ø®ØªØµØ§Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                            <textarea class="form-control" id="id_sub_description" name="sub_description" style="height: 165px" rows="5" required>{{ form.sub_description.value|default_if_none:'' }}</textarea>
                            {% if form.sub_description.errors %}
                                <div class="alert alert-danger">{{ form.sub_description.errors }}</div>
                            {% endif %}
                        </div>
                        <!-- Custom rendering for category (dropdown with search) -->
                        <div class="mb-3 col-md-3">
                            <!-- Search Input for Category -->
                            <label for="id_search_category" class="form-label">Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¬Ø§Ù„:</label>
                            <input 
                                type="text" 
                                id="id_search_category" 
                                class="form-control" 
                                placeholder="Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¬Ø§Ù„..."
                            >
                            <label for="id_category" class="form-label">Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø¬Ø§Ù„:</label><br>
                            {% for category in form.fields.category.queryset %}
                                <div class="form-check category-checkbox">
                                    <input 
                                        class="form-check-input" 
                                        type="radio" 
                                        name="category" 
                                        value="{{ category.id }}" 
                                        id="category_{{ category.id }}"
                                    >
                                    <label class="form-check-label" for="category_{{ category.id }}">
                                        {{ category }}
                                    </label>
                                </div>
                            {% endfor %}
                        </div>

                        <!-- JavaScript for Filtering Category -->
                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                const searchInputCategory = document.getElementById('id_search_category');
                                const categoryCheckboxes = document.querySelectorAll('.category-checkbox');
                                
                                function filterCategory() {
                                    const query = searchInputCategory.value.toLowerCase();
                                    let counter = 0;  // Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† Ø§Ù„ØµÙØ±
                                    
                                    categoryCheckboxes.forEach(function (checkbox) {
                                        const label = checkbox.querySelector('.form-check-label').textContent.toLowerCase();
                                        
                                        if (query === '' || label.includes(query)) {
                                            if (counter < 5) {
                                                checkbox.style.display = 'block';  // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¯Ø®Ù„ Ø£Ùˆ Ø§Ù„Ø¨Ø­Ø« ÙØ§Ø±Øº
                                                counter++;  // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯
                                            } else {
                                                checkbox.style.display = 'none';  // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¥Ø°Ø§ ØªÙ… Ø¹Ø±Ø¶ 5 Ø¨Ø§Ù„ÙØ¹Ù„
                                            }
                                        } else {
                                            checkbox.style.display = 'none';  // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ø°Ø§ Ù„Ù… ÙŠØªØ·Ø§Ø¨Ù‚
                                        }
                                    });
                                }
                        
                                searchInputCategory.addEventListener('input', filterCategory);
                                filterCategory();  // Ù„ØªØµÙÙŠØ© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                            });
                        </script>
                        
                        <!-- Custom rendering for doctor (dropdown with search) -->
                        <div class="mb-3 col-md-3">
                            <!-- Search Input for Doctor -->
                            <label for="id_search_doctor" class="form-label">Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¯ÙƒØªÙˆØ±Ù‡:</label>
                            <input 
                                type="text" 
                                id="id_search_doctor" 
                                class="form-control" 
                                placeholder="Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¯ÙƒØªÙˆØ±Ù‡..."
                            >
                            
                            <label for="id_doctor" class="form-label">Ø­Ø¯Ø¯ Ø§Ù„Ø¯ÙƒØªÙˆØ±Ù‡:</label><br>
                            
                            <!-- Loop through all doctors and show first 5 initially -->
                            {% for doctor in form.fields.doctor.queryset %}
                                <div class="form-check doctor-checkbox" style="display: none;">
                                    <input 
                                        class="form-check-input" 
                                        type="radio" 
                                        name="doctor" 
                                        value="{{ doctor.id }}" 
                                        id="doctor_{{ doctor.id }}"
                                    >
                                    <label class="form-check-label" for="doctor_{{ doctor.id }}">
                                        {{ doctor }}
                                    </label>
                                </div>
                            {% endfor %}
                        </div>
                        
                        <!-- JavaScript for Filtering Doctor -->
                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                const searchInputDoctor = document.getElementById('id_search_doctor');
                                const doctorCheckboxes = document.querySelectorAll('.doctor-checkbox');
                                function filterDoctors() {
                                    const query = searchInputDoctor.value.toLowerCase();
                                    if (query === '') {
                                        let counter = 0;
                                        doctorCheckboxes.forEach(function (checkbox, index) {
                                            if (counter < 5) {
                                                checkbox.style.display = 'block';
                                                counter++;
                                            } else {
                                                checkbox.style.display = 'none';
                                            }
                                        });
                                    }else {
                                        let counter = 0;  // Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† Ø§Ù„ØµÙØ±
                                        doctorCheckboxes.forEach(function (checkbox) {
                                            const label = checkbox.querySelector('.form-check-label').textContent.toLowerCase();
                                            if (label.includes(query) && counter < 5) {
                                                checkbox.style.display = 'block';  // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¯Ø®Ù„
                                                counter++;  // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯
                                            } else {
                                                checkbox.style.display = 'none';  // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ø°Ø§ Ù„Ù… ÙŠØªØ·Ø§Ø¨Ù‚ Ø£Ùˆ Ø¥Ø°Ø§ ØªØ¬Ø§ÙˆØ²Ù†Ø§ Ø§Ù„Ø¹Ø¯Ø¯ 5
                                            }
                                        });
                                    }  
                                }
                                searchInputDoctor.addEventListener('input', filterDoctors);
                                filterDoctors();
                            });
                        </script>





                        <!-- Custom rendering for students (checkboxes with search) -->
                        <div class="mb-3 col-md-3">
                            <!-- Search Input for Students -->
                            <label for="id_search_students" class="form-label">Ø¨Ø­Ø« Ø§Ù„Ø·Ù„Ø§Ø¨:</label>
                            <input 
                                type="text" 
                                id="id_search_students" 
                                class="form-control mb-2" 
                                placeholder="Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø·Ù„Ø§Ø¨..."
                            >
                            <label for="id_students" class="form-label">Ø­Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨:</label><br>
                            {% for student in form.fields.students.queryset %}
                                <div class="form-check student-checkbox">
                                    <input 
                                        class="form-check-input" 
                                        type="checkbox" 
                                        name="students" 
                                        value="{{ student.id }}" 
                                        id="student_{{ student.id }}"
                                    >
                                    <label class="form-check-label" for="student_{{ student.id }}">
                                        {{ student }}
                                    </label>
                                </div>
                            {% endfor %}
                        </div>

                        <!-- JavaScript for Filtering Students -->
                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                const searchInputStudents = document.getElementById('id_search_students');
                                const studentCheckboxes = document.querySelectorAll('.student-checkbox');
                                function filterStudents() {
                                    const query = searchInputStudents.value.toLowerCase();
                                    let counter = 0;  // Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† Ø§Ù„ØµÙØ±
                                    studentCheckboxes.forEach(function (checkbox) {
                                        const label = checkbox.querySelector('.form-check-label').textContent.toLowerCase();
                                        if (query === '' || label.includes(query)) {
                                            if (counter < 5) {
                                                checkbox.style.display = 'block';  // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¯Ø®Ù„ Ø£Ùˆ Ø§Ù„Ø¨Ø­Ø« ÙØ§Ø±Øº
                                                counter++;  // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯
                                            } else {
                                                checkbox.style.display = 'none';  // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¥Ø°Ø§ ØªÙ… Ø¹Ø±Ø¶ 5 Ø¨Ø§Ù„ÙØ¹Ù„
                                            }
                                        } else {
                                            let counter = 0;  // Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† Ø§Ù„ØµÙØ±
                                            studentCheckboxes.forEach(function (checkbox) {
                                                const label = checkbox.querySelector('.form-check-label').textContent.toLowerCase();
                                                if (label.includes(query) && counter < 5) {
                                                    checkbox.style.display = 'block';  // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¯Ø®Ù„
                                                    counter++;  // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯
                                                } else {
                                                    checkbox.style.display = 'none';  // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ø°Ø§ Ù„Ù… ÙŠØªØ·Ø§Ø¨Ù‚ Ø£Ùˆ Ø¥Ø°Ø§ ØªØ¬Ø§ÙˆØ²Ù†Ø§ Ø§Ù„Ø¹Ø¯Ø¯ 5
                                                }
                                            });
                                        }
                                    });
                                }
                                searchInputStudents.addEventListener('input', filterStudents);
                                filterStudents();  // Ù„ØªØµÙÙŠØ© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                            });
                        </script>
                            

                    
                        <!-- Custom rendering for supervisors (checkboxes with search) -->
                        <div class="mb-3 col-md-3">
                            <!-- Search Input for Supervisors -->
                            <label for="id_search_supervisors" class="form-label">Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†:</label>
                            <input 
                                type="text" 
                                id="id_search_supervisors" 
                                class="form-control mb-2" 
                                placeholder="Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†..."
                            >
                            <label for="id_supervisors" class="form-label">Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†:</label><br>
                            {% for supervisor in form.fields.supervisors.queryset %}
                                <div class="form-check supervisor-checkbox">
                                    <input 
                                        class="form-check-input" 
                                        type="checkbox" 
                                        name="supervisors" 
                                        value="{{ supervisor.id }}" 
                                        id="supervisor_{{ supervisor.id }}"
                                    >
                                    <label class="form-check-label" for="supervisor_{{ supervisor.id }}">
                                        {{ supervisor }}
                                    </label>
                                </div>
                            {% endfor %}
                        </div>

                        <!-- JavaScript for Filtering Supervisors -->
                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                const searchInputSupervisors = document.getElementById('id_search_supervisors');
                                const supervisorCheckboxes = document.querySelectorAll('.supervisor-checkbox');
                                
                                function filterSupervisors() {
                                    const query = searchInputSupervisors.value.toLowerCase();
                                    let counter = 0;  // Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† Ø§Ù„ØµÙØ±
                        
                                    supervisorCheckboxes.forEach(function (checkbox) {
                                        const label = checkbox.querySelector('.form-check-label').textContent.toLowerCase();
                                        
                                        if (query === '' || label.includes(query)) {
                                            if (counter < 5) {
                                                checkbox.style.display = 'block';  // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¯Ø®Ù„ Ø£Ùˆ Ø§Ù„Ø¨Ø­Ø« ÙØ§Ø±Øº
                                                counter++;  // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯
                                            } else {
                                                checkbox.style.display = 'none';  // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¥Ø°Ø§ ØªÙ… Ø¹Ø±Ø¶ 5 Ø¨Ø§Ù„ÙØ¹Ù„
                                            }
                                        } else {
                                            checkbox.style.display = 'none';  // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ø°Ø§ Ù„Ù… ÙŠØªØ·Ø§Ø¨Ù‚
                                        }
                                    });
                                }
                        
                                searchInputSupervisors.addEventListener('input', filterSupervisors);
                                filterSupervisors();  // Ù„ØªØµÙÙŠØ© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                            });
                        </script>

                    
                        <!-- Ù…Ù„Ù PDF -->
                        <div class="form-group col-lg-4">
                            <label for="id_book_pdf">Ù…Ù„Ù PDF</label>
                            <input type="file" class="form-control-file" id="id_book_pdf" name="book_pdf" >
                            {% if form.book_pdf.errors %}
                                <div class="alert alert-danger">{{ form.book_pdf.errors }}</div>
                            {% endif %}
                        </div>
                    
                        <!-- Ø§Ù„ØµÙˆØ±Ù‡-->
                        <div class="form-group col-lg-4">
                            <label for="id_images">Ø§Ù„ØµÙˆØ±Ù‡ Ø§Ù„Ø±Ø¦ÙŠØ³Ù‡</label>
                            <input type="file" class="form-control-file" id="id_images" name="images" multiple >
                            {% if form.images.errors %}
                                <div class="alert alert-danger">{{ form.images.errors }}</div>
                            {% endif %}
                        </div>
                    
                    

                        <!-- Ø§Ù„ÙÙŠØ¯ÙŠÙˆ -->
                        <div class="form-group col-lg-4">
                            <label for="id_video">Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</label>
                            <input type="file" name="video" accept="video/*">
                            {% if form.video.errors %}
                                <div class="alert alert-danger">{{ form.video.errors }}</div>
                            {% endif %}
                        </div>
                        

                         
                        
                        
                        <!-- Ø§Ù„ØµÙˆØ± -->
                       <div class="form-group">
                        <label for="id_images">ØµÙˆØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ </label>
                        <input 
                            type="file" 
                            class="form-control-file" 
                            id="id_images" 
                            name="images" 
                            multiple 
                            accept="image/*"
                            onchange="validateImageCount(this)"
                        >
                        {% if form.images.errors %}
                            <div class="alert alert-danger">{{ form.images.errors }}</div>
                        {% endif %}
                    </div>
                     
                    
                    {% comment %} // Validate Image Count {% endcomment %}
                        {% comment %} <script>
                            function validateImageCount(input) {
                            if (input.files.length > 4) {
                                alert('ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ù…ÙŠÙ„ Ø­ØªÙ‰ 4 ØµÙˆØ± ÙÙ‚Ø·.');
                                        input.value = ''; // Clear the input
                                    }
                                }
                            
                        </script> {% endcomment %}







        
                        <!-- Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ -->
                         <div class="button_seo">
                        <button type="submit" class="btn seo">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button>
                         </div>
                    </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
</section>



<style>
    .button_seo{
        text-align: center;
    }
    .seo{
        background: rgb(0, 70, 88);
        width: 200px;
        border-radius: 12px;
        color: white;
    }
    textarea{
        height:100px
    }
</style>

<!-- JavaScript for Delay and Redirection -->
<!-- JavaScript for Delay and Redirection -->
<script>
    const messages = document.querySelectorAll('.alert');
    let hasError = false;

    // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£ÙŠ Ø±Ø³Ø§Ø¦Ù„ Ø®Ø·Ø£
    messages.forEach(message => {
        if (message.textContent.toLowerCase().includes('error')) {
            hasError = true;
        }
    });

    // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£ØŒ Ù‚Ù… Ø¨Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù
    if (messages.length > 0 && !hasError) {
        setTimeout(() => {
            window.location.href = "{% url 'project:success_create_project' %}";
        }, 5000); // 5000 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ© = 5 Ø«ÙˆØ§Ù†Ù
    }
</script>


{% endblock body %}
